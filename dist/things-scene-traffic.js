!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@hatiolab/things-scene")):"function"==typeof define&&define.amd?define(["exports","@hatiolab/things-scene"],e):e((t=t||self)["things-scene-traffic"]={},t.scene)}(this,function(t,e){"use strict";const a={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"color",label:"Ray color",name:"rayColor"}]};class i{constructor(t,e,a){this.id=t,this.startedAt=Date.now(),this.ttl=a;var i=Math.random()*Math.PI*2;this.line={x1:0,y1:0,x2:0+e*Math.cos(i),y2:0+e*Math.sin(i)}}get endedAt(){return this.startedAt+this.ttl}end(){this.ended=!0}get ray(){var t=Date.now(),e=this.startedAt,a=(t-e)/(this.endedAt-e);this.ended&&(a=Math.min(1,this.lastRatio+.05)),this.lastRatio||(this.lastRatio=0);var{x1:i,y1:s,x2:r,y2:n}=this.line,o={x1:i+(r-i)*this.lastRatio,y1:s+(n-s)*this.lastRatio,x2:i+(r-i)*a,y2:s+(n-s)*a};return this.lastRatio=a,o}}class s extends(e.RectPath(e.Shape)){dispose(){this._rap&&(cancelAnimationFrame(this._rap),delete this._rap),super.dispose()}ready(){this._rap=requestAnimationFrame(()=>{this.ready()}),this.invalidate()}get rays(){return this._rays||(this._rays={}),this._rays}cometCreated(t,e){this.rays[t]=e}cometDestroyed(t){var e=this.rays[t];e&&e.end()}_draw(t){var{top:e,left:a,height:i,width:s}=this.bounds,{x:r,y:n}=this.center;t.beginPath(),t.fillStyle=this.getState("fillStyle")||"black",t.rect(a,e,s,i),t.clip(),t.fill(),t.lineCap="round",Object.values(this.rays).forEach(e=>{let a=e.ray;if(!e.ended&&e.lastRatio>=1)return void delete this.rays[e.id];let i=Math.round(10*e.lastRatio),s=this.getState("rayColor")||"#5577aa";if(!e.ended){s=`#${Math.round(255*e.lastRatio).toString(16).padStart(2,"0")}2233`}t.save(),t.beginPath(),t.lineWidth=1+i/(e.ended?3:1),t.strokeStyle=s,t.globalAlpha=e.lastRatio%1,t.moveTo(r+a.x1,n+a.y1),t.lineTo(r+a.x2,n+a.y2),t.stroke(),t.restore(),e.ended&&e.lastRatio>=1&&delete this.rays[e.id]})}_post_draw(){}get controls(){}get nature(){return a}handleQueueIn(t){var{id:e,ttl:a,intime:s}=t,{width:r,height:n}=this.bounds;this.cometCreated(e,new i(e,Math.sqrt(r*r+n*n)/3,a))}handleConsume(t){var{id:e}=t;this.cometDestroyed(e)}handleTimeout(){}onchangeData(t,e){var{data:a}=t;a&&(!a instanceof Array&&(a=[a]),a.forEach(t=>{switch(t.type){case"publish":this.handleQueueIn(t);break;case"consume":this.handleConsume(t);break;case"timeout":this.handleTimeout(t)}}),this.invalidate())}onchange(t,e){}}e.Component.register("traffic-galaxy",s),t.TrafficGalaxy=s,Object.defineProperty(t,"__esModule",{value:!0})});
