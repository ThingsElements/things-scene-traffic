(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _trafficGalaxy=require("./traffic-galaxy");Object.defineProperty(exports,"TrafficGalaxy",{enumerable:true,get:function get(){return _interopRequireDefault(_trafficGalaxy).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./traffic-galaxy":2}],2:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var NATURE={mutable:false,resizable:true,rotatable:true,properties:[{type:"color",label:"Ray color",name:"rayColor"}]};var _scene=scene,RectPath=_scene.RectPath,Shape=_scene.Shape;var Ray=function(){function Ray(id,length,ttl){_classCallCheck(this,Ray);this.id=id;this.startedAt=Date.now();this.ttl=ttl;var theta=Math.random()*Math.PI*2;this.line={x1:0,y1:0,x2:0+length*Math.cos(theta),y2:0+length*Math.sin(theta)}}_createClass(Ray,[{key:"end",value:function end(){this.ended=true}},{key:"endedAt",get:function get(){return this.startedAt+this.ttl}},{key:"ray",get:function get(){var now=Date.now();var startedAt=this.startedAt;var endedAt=this.endedAt;var ratio=(now-startedAt)/(endedAt-startedAt);if(this.ended){ratio=Math.min(1,this.lastRatio+.05)}if(!this.lastRatio)this.lastRatio=0;var _line=this.line,x1=_line.x1,y1=_line.y1,x2=_line.x2,y2=_line.y2;var line={x1:x1+(x2-x1)*this.lastRatio,y1:y1+(y2-y1)*this.lastRatio,x2:x1+(x2-x1)*ratio,y2:y1+(y2-y1)*ratio};this.lastRatio=ratio;return line}}]);return Ray}();var TrafficGalaxy=function(_RectPath){_inherits(TrafficGalaxy,_RectPath);function TrafficGalaxy(){_classCallCheck(this,TrafficGalaxy);return _possibleConstructorReturn(this,(TrafficGalaxy.__proto__||Object.getPrototypeOf(TrafficGalaxy)).apply(this,arguments))}_createClass(TrafficGalaxy,[{key:"dispose",value:function dispose(){_get(TrafficGalaxy.prototype.__proto__||Object.getPrototypeOf(TrafficGalaxy.prototype),"dispose",this).call(this)}},{key:"added",value:function added(){var _this2=this;var _bounds=this.bounds,width=_bounds.width,height=_bounds.height;var _center=this.center,x=_center.x,y=_center.y;requestAnimationFrame(function(){_this2.added()});this.invalidate()}},{key:"cometCreated",value:function cometCreated(id,ray){this.rays[id]=ray}},{key:"cometDestroyed",value:function cometDestroyed(id){var ray=this.rays[id];if(ray)ray.end()}},{key:"_draw",value:function _draw(context){var _this3=this;var _bounds2=this.bounds,top=_bounds2.top,left=_bounds2.left,height=_bounds2.height,width=_bounds2.width;var _center2=this.center,x=_center2.x,y=_center2.y;context.beginPath();context.fillStyle=this.getState("fillStyle")||"black";context.rect(left,top,width,height);context.clip();context.fill();context.lineCap="round";var now=Date.now();Object.values(this.rays).forEach(function(ray){var line=ray.ray;if(!ray.ended&&ray.lastRatio>=1){delete _this3.rays[ray.id];return}var weight=Math.round(ray.lastRatio*10);var strokeStyle=_this3.getState("rayColor")||"#5577aa";if(!ray.ended){var style=Math.round(255*ray.lastRatio).toString(16);strokeStyle="#"+style.padStart(2,"0")+"2233"}context.beginPath();context.lineWidth=1+weight/(ray.ended?3:1);context.strokeStyle=strokeStyle;context.moveTo(x+line.x1,y+line.y1);context.lineTo(x+line.x2,y+line.y2);context.stroke();if(ray.ended&&ray.lastRatio>=1){delete _this3.rays[ray.id]}})}},{key:"_post_draw",value:function _post_draw(){}},{key:"handleQueueIn",value:function handleQueueIn(data){var id=data.id,ttl=data.ttl,intime=data.intime;var _bounds3=this.bounds,width=_bounds3.width,height=_bounds3.height;this.cometCreated(id,new Ray(id,Math.sqrt(width*width+height*height)/3,ttl))}},{key:"handleConsume",value:function handleConsume(data){var id=data.id;this.cometDestroyed(id)}},{key:"handleTimeout",value:function handleTimeout(){}},{key:"onchangeData",value:function onchangeData(after,before){var _this4=this;var data=after.data;if(!data)return;if(!data instanceof Array)data=[data];data.forEach(function(d){switch(d.type){case"publish":_this4.handleQueueIn(d);break;case"consume":_this4.handleConsume(d);break;case"timeout":_this4.handleTimeout(d);break}});this.invalidate()}},{key:"onchange",value:function onchange(after,before){console.log("onchange")}},{key:"rays",get:function get(){if(!this._rays)this._rays={};return this._rays}},{key:"controls",get:function get(){}},{key:"nature",get:function get(){return NATURE}}]);return TrafficGalaxy}(RectPath(Shape));exports.default=TrafficGalaxy;scene.Component.register("traffic-galaxy",TrafficGalaxy)},{}]},{},[1]);